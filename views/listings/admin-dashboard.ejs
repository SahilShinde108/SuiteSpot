<% layout("/layouts/boilerplate") %>
<div class="row mt-3">
    <div class="col-10 offset-1">
        <h3>Admin Dashboard</h3>
        <p>Manage listing approvals here.</p>

        <ul class="nav nav-tabs mb-3" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">Pending (<%= pendingListings.length %>)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab" aria-controls="approved" aria-selected="false">Approved (<%= approvedListings.length %>)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab" aria-controls="rejected" aria-selected="false">Rejected (<%= rejectedListings.length %>)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="owners-tab" data-bs-toggle="tab" data-bs-target="#owners" type="button" role="tab" aria-controls="owners" aria-selected="false">Owners</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="customers-tab" data-bs-toggle="tab" data-bs-target="#customers" type="button" role="tab" aria-controls="customers" aria-selected="false">Customers</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings" type="button" role="tab" aria-controls="bookings" aria-selected="false">Bookings</button>
            </li>
        </ul>

        <div class="tab-content" id="adminTabsContent">
            <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
                <h4>Pending Listings</h4>
                <% if (pendingListings.length > 0) { %>
                    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
                        <% for(let listing of pendingListings) { %>
                            <div class="card col listing-card">
                                <img src="<%= listing.image %>" class="card-img-top" alt="listing_image" style="height: 20rem;">
                                <div class="card-img-overlay"></div>
                                <div class="card-body">
                                    <p class="card-text"><b><%= listing.title %></b> <br>
                                        &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
                                    </p>
                                    <a href="/listings/<%= listing.id %>" class="stretched-link"></a>
                                </div>
                            </div>
                        <% } %>
                    </div>
                <% } else { %>
                    <p>No pending listings.</p>
                <% } %>
            </div>
            <div class="tab-pane fade" id="approved" role="tabpanel" aria-labelledby="approved-tab">
                <h4>Approved Listings</h4>
                <% if (approvedListings.length > 0) { %>
                    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
                        <% for(let listing of approvedListings) { %>
                            <div class="card col listing-card">
                                <img src="<%= listing.image %>" class="card-img-top" alt="listing_image" style="height: 20rem;">
                                <div class="card-img-overlay"></div>
                                <div class="card-body">
                                    <p class="card-text"><b><%= listing.title %></b> <br>
                                        &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
                                    </p>
                                    <a href="/listings/<%= listing.id %>" class="stretched-link"></a>
                                </div>
                            </div>
                        <% } %>
                    </div>
                <% } else { %>
                    <p>No approved listings.</p>
                <% } %>
            </div>
            <div class="tab-pane fade" id="rejected" role="tabpanel" aria-labelledby="rejected-tab">
                <h4>Rejected Listings</h4>
                <% if (rejectedListings.length > 0) { %>
                    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
                        <% for(let listing of rejectedListings) { %>
                            <div class="card col listing-card">
                                <img src="<%= listing.image %>" class="card-img-top" alt="listing_image" style="height: 20rem;">
                                <div class="card-img-overlay"></div>
                                <div class="card-body">
                                    <p class="card-text"><b><%= listing.title %></b> <br>
                                        &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
                                    </p>
                                    <a href="/listings/<%= listing.id %>" class="stretched-link"></a>
                                </div>
                            </div>
                        <% } %>
                    </div>
                <% } else { %>
                    <p>No rejected listings.</p>
                <% } %>
            </div>
            <div class="tab-pane fade" id="owners" role="tabpanel" aria-labelledby="owners-tab">
                <h4>Owners</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(let user of allUsers) { %>
                            <% if (user.role === 'owner') { %>
                                <tr>
                                    <td><%= user.username %></td>
                                    <td><%= user.email %></td>
                                </tr>
                            <% } %>
                        <% } %>
                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="customers" role="tabpanel" aria-labelledby="customers-tab">
                <h4>Customers</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(let user of allUsers) { %>
                            <% if (user.role === 'customer') { %>
                                <tr>
                                    <td><%= user.username %></td>
                                    <td><%= user.email %></td>
                                </tr>
                            <% } %>
                        <% } %>
                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="bookings" role="tabpanel" aria-labelledby="bookings-tab">
                <h4>All Bookings</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Listing Title</th>
                            <th>Guest Username</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Total Price</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(let booking of allBookings) { %>
                            <tr>
                                <td><%= booking.Listing.title %></td>
                                <td><%= booking.guest.username %></td>
                                <td><%= booking.startDate.toLocaleDateString() %></td>
                                <td><%= booking.endDate.toLocaleDateString() %></td>
                                <td>&#8377; <%= booking.totalPrice.toLocaleString("en-IN") %></td>
                                <td><%= booking.status %></td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>